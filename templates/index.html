<!DOCTYPE html>
<html>
<head>
    <title>Financial Analyzer</title>
    <meta charset="UTF-8">
    <style>
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f0f0f0;
            --bg-button: #f0f0f0;
            --bg-button-hover: #e0e0e0;
            --text-primary: #000000;
            --text-secondary: #333333;
            --border-color: #ccc;
            --active-color: #007bff;
            --active-border: #0056b3;
            --shadow-color: rgba(0,0,0,0.1);
        }

        [data-theme="dark"] {
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --bg-button: #3d3d3d;
            --bg-button-hover: #4d4d4d;
            --text-primary: #ffffff;
            --text-secondary: #e0e0e0;
            --border-color: #666;
            --active-color: #0056b3;
            --active-border: #004099;
            --shadow-color: rgba(255,255,255,0.1);
        }

        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            transition: background-color 0.3s, color 0.3s;
        }

        h1 {
            color: var(--text-primary);
        }

        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 20px;
            background-color: var(--bg-button);
            border: 1px solid var(--border-color);
            border-radius: 5px;
            cursor: pointer;
            color: var(--text-primary);
            font-size: 14px;
            transition: all 0.3s;
            z-index: 1000;
        }

        .theme-toggle:hover {
            background-color: var(--bg-button-hover);
        }

        .metric-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .metric-button {
            padding: 10px 20px;
            background-color: var(--bg-button);
            border: 1px solid var(--border-color);
            border-radius: 5px;
            cursor: pointer;
            color: var(--text-primary);
            transition: all 0.3s;
        }

        .metric-button:hover {
            background-color: var(--bg-button-hover);
        }

        .metric-button.active {
            background-color: var(--active-color);
            color: white;
            border-color: var(--active-border);
        }

        #chart-container {
            margin-top: 20px;
            background-color: var(--bg-secondary);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px var(--shadow-color);
        }

        .chart-frame {
            width: 100%;
            border: none;
            display: none;
            border-radius: 4px;
            min-height: 900px;
            background-color: var(--bg-primary);
        }

        .chart-frame.active {
            display: block;
        }

        .metric-button:focus {
            outline: 2px solid var(--active-color);
            outline-offset: 2px;
        }

        [data-theme="dark"] ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        [data-theme="dark"] ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }

        [data-theme="dark"] ::-webkit-scrollbar-thumb {
            background: var(--bg-button);
            border-radius: 5px;
        }

        [data-theme="dark"] ::-webkit-scrollbar-thumb:hover {
            background: var(--bg-button-hover);
        }
    </style>
</head>
<body>
<h1>Financial Analyzer</h1>

<button class="theme-toggle" id="themeToggle">ðŸŒ™ Dark theme</button>

<div class="metric-buttons" id="metric-buttons"></div>
<div id="chart-container"></div>

<script>
    const metrics = {{.Metrics}};
    const container = document.getElementById('chart-container');
    const buttonsContainer = document.getElementById('metric-buttons');
    const themeToggle = document.getElementById('themeToggle');
    let charts = {};

    function getCurrentTheme() {
        return document.documentElement.getAttribute('data-theme') || 'light';
    }

    function reloadAllIframes(theme) {
        Object.keys(charts).forEach(metric => {
            const iframe = charts[metric];
            const wasActive = iframe.classList.contains('active');
            iframe.src = `/chart/${metric}?theme=${theme}&t=${Date.now()}`;

            if (wasActive) {
                iframe.onload = function() {
                    iframe.classList.add('active');
                };
            }
        });
    }

    function setTheme(theme) {
        const html = document.documentElement;
        if (theme === 'dark') {
            html.setAttribute('data-theme', 'dark');
            themeToggle.innerHTML = 'â˜€ï¸ Light theme';
        } else {
            html.removeAttribute('data-theme');
            themeToggle.innerHTML = 'ðŸŒ™ Dark theme';
        }
        localStorage.setItem('theme', theme);
        reloadAllIframes(theme);
    }

    function toggleTheme() {
        const currentTheme = getCurrentTheme();
        setTheme(currentTheme === 'dark' ? 'light' : 'dark');
    }

    function loadTheme() {
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme) {
            setTheme(savedTheme);
        } else {
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            setTheme(prefersDark ? 'dark' : 'light');
        }
    }

    themeToggle.addEventListener('click', toggleTheme);

    metrics.forEach((metric, index) => {
        const iframe = document.createElement('iframe');
        iframe.className = 'chart-frame';
        iframe.id = `chart-${metric}`;
        iframe.src = `/chart/${metric}?theme=${getCurrentTheme()}`;

        container.appendChild(iframe);
        charts[metric] = iframe;

        const button = document.createElement('button');
        button.className = 'metric-button' + (index === 0 ? ' active' : '');
        button.textContent = formatMetricName(metric);
        button.setAttribute('data-metric', metric);
        button.addEventListener('click', function() {
            showChart(metric);
        });
        buttonsContainer.appendChild(button);
    });

    function showChart(metric) {
        document.querySelectorAll('.chart-frame').forEach(iframe => {
            iframe.classList.remove('active');
        });
        document.querySelectorAll('.metric-button').forEach(btn => {
            btn.classList.remove('active');
        });

        const iframe = document.getElementById(`chart-${metric}`);
        iframe.classList.add('active');

        const activeButton = Array.from(document.querySelectorAll('.metric-button')).find(
            btn => btn.getAttribute('data-metric') === metric
        );
        if (activeButton) {
            activeButton.classList.add('active');
        }
    }

    function formatMetricName(metric) {
        const names = {
            'revenue': 'Revenue',
            'net_profit': 'Net Profit',
            'ebitda': 'EBITDA',
            'pe': 'P/E Ratio',
            'roe': 'ROE (%)',
            'capitalization': 'Market Cap',
            'debt': 'Debt'
        };
        return names[metric] || metric;
    }

    if (metrics.length > 0) {
        showChart(metrics[0]);
    }

    loadTheme();
</script>
</body>
</html>